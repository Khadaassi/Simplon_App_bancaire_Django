{% extends "theme/con_base.html" %}

{% block title %}Loan Request Details #{{ loan.id }} - BAMK{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto mt-10 bg-white p-8 shadow-lg rounded-lg">
    <h2 class="text-3xl font-semibold text-deepblue mb-6">Loan Request Details #{{ loan.id }}</h2>

    <div class="bg-gray-100 p-6 rounded-lg shadow-md">
        <!-- Client Information -->
        <h3 class="text-xl font-semibold text-deepblue mb-4">Client Information</h3>
        <div class="grid grid-cols-2 gap-4 mb-6">
            <p><strong>Client:</strong> {{ loan.user.username }}</p>
            <p><strong>State:</strong> {{ loan.state }}</p>
            <p><strong>NAICS:</strong> {{ loan.naics }}</p>
            <p><strong>Business Type:</strong> {% if loan.new_exist == 1 %}New{% else %}Existing{% endif %}</p>
        </div>

        <!-- Loan Details -->
        <h3 class="text-xl font-semibold text-deepblue mb-4">Loan Details</h3>
        <div class="grid grid-cols-2 gap-4 mb-6">
            <p><strong>Retained Jobs:</strong> {{ loan.retained_job }}</p>
            <p><strong>Franchise Code:</strong> {{ loan.franchise_code }}</p>
            <p><strong>Zone:</strong> {% if loan.urban_rural == 1 %}Urban{% else %}Rural{% endif %}</p>
            <p><strong>Approved Amount:</strong> ${{ loan.gr_appv }}</p>
            <p><strong>Bank:</strong> {{ loan.bank }}</p>
            <p><strong>Term:</strong> {{ loan.term }} months</p>
        </div>

        <!-- Status & Actions -->
        <h3 class="text-xl font-semibold text-deepblue mb-4">Status & Actions</h3>
        <div class="grid grid-cols-2 gap-4 mb-6">
            <p><strong>AI Prediction:</strong> {{ loan.prediction }}</p>
            <p><strong>Status:</strong><span class="px-2 py-1 rounded">{{ loan.get_status_display }}</span></p>
        </div>

        {% if is_advisor and loan.status == 'ai_approved' %}
            <form method="post" class="mt-4">
                {% csrf_token %}
                <div class="flex justify-center space-x-4">
                    <button type="submit" name="approve" class="bg-deepblue text-white px-6 py-2 rounded-lg hover:bg-skyblue transition">Approve</button>
                    <button type="submit" name="reject" class="bg-deepblue text-white px-6 py-2 rounded-lg hover:bg-skyblue transition">Reject</button>
                </div>
            </form>
        {% endif %}

        <div class="mt-6 flex justify-center">
            {% if is_advisor %}
                <a href="{% url 'loan:advisor_loans' %}" class="px-4 py-2 bg-white text-navy rounded-lg shadow hover:bg-skyblue transition">Back to List</a>
            {% else %}
                <a href="{% url 'loan:client_loans' %}" class="px-4 py-2 bg-white text-navy rounded-lg shadow hover:bg-skyblue transition">Back to My Loans</a>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}
